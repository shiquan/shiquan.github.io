

# RunBlockCorr

[**Source code**](https://github.com/shiquan/Yano/tree/master/R/dissimilarity.R#L78)

## Description

Run spatial dissimilarity test for features and their binding features
in parallel.

## Usage

<pre><code class='language-R'>RunBlockCorr(
  object = NULL,
  bind.name = "gene_name",
  features = NULL,
  assay = NULL,
  min.cells = 10,
  bind.assay = NULL,
  bind.features = NULL,
  min.cells.bind = 10,
  prefix = NULL,
  subset = NULL,
  min.features.per.block = 1,
  scale.factor = 10000,
  mode = c(1, 2, 3),
  method = c("D", "D2", "Lee"),
  library.size = NULL,
  wm.name = NULL,
  perm = 100,
  seed = 999,
  threads = 0,
  verbose = TRUE,
  debug = FALSE,
  cells = NULL,
  idents = NULL,
  node = NULL,
  reduction = "pca",
  dims = 1:10,
  k.param = 20,
  prune.SNN = 1/50,
  n.trees = 50,
  nn.eps = 0,
  nn.method = "annoy",
  annoy.metric = "euclidean"
)
</code></pre>

## Arguments

<table>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="object">object</code>
</td>
<td>
Seurat object
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="bind.name">bind.name</code>
</td>
<td>
Title name for binding features in the meta table. Consider most users
start Yano to perform alternative splicing analysis, the default
bind.name set to "gene_name".
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="features">features</code>
</td>
<td>
Vector of features to calculate. Default is AutoCorrFeatures(object).
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="assay">assay</code>
</td>
<td>
Work assay.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="min.cells">min.cells</code>
</td>
<td>
Features detected in few than minimal number of cells will be skipped.
Default is 10.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="bind.assay">bind.assay</code>
</td>
<td>
Name of binding assay.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="bind.features">bind.features</code>
</td>
<td>
List of bind features. Default use all.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="min.cells.bind">min.cells.bind</code>
</td>
<td>
Binding features detected in few than minimal number of cells will be
skipped. Default is 10.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="prefix">prefix</code>
</td>
<td>
Prefix name for output scores and values. Default is same with
bind.name.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="scale.factor">scale.factor</code>
</td>
<td>
Scale factor to normalise counts. Default is 1e4. For mode 1, this
function will use data from Layer ‘data’. For mode 2 and 3, will use
data from Layer ‘counts’. The counts will further be normalised with
sample size and scale factor for spatial dissimilarity test.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="mode">mode</code>
</td>
<td>
Test mode. For mode 1, X (test feature) vs Y (binding feature). For mode
2, X vs (Y-X). For mode 3, X vs (Y+X). Please note, when set to mode 2
or 3, will use raw counts to update expression value of binding
features. Then normalise the counts before testing. For mode 1, will use
Layer ‘data’. Default is mode 1.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="method">method</code>
</td>
<td>
Method to use. Support D, D2 and Lee.
*D* = *s**q**r**t*(*L*<sub>*x*</sub>)(1 − *r*<sub>*x*</sub>*y*).
*D*2 = *s**q**r**t*(*L*<sub>*x*</sub>)*s**q**r**t*(*L*<sub>*y*</sub>)(1 − *r*<sub>*x*</sub>*y*).
Lee for Lee’s Score. In default use D method, see the manual for
details.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="library.size">library.size</code>
</td>
<td>
Library size for each cell, used for normalise counts when mode is 2 or
3. If not set, use colSum(counts) instead.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="wm.name">wm.name</code>
</td>
<td>
Weight matrix name, this matrix (graph) generated by
<code>RunAutoCorr</code>.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="perm">perm</code>
</td>
<td>
Permutations for evaluating mean and sd of D/L scores. Default is 100.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="seed">seed</code>
</td>
<td>
Seed for generate random number. Default is 999.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="threads">threads</code>
</td>
<td>
Threads. If set to 0 (default), will auto check the CPU cores and set
threads = number of CPU cores -1.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="debug">debug</code>
</td>
<td>
Print debug message. Will auto set thread to 1. Default is FALSE.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="cells">cells</code>
</td>
<td>
Calculate scores for predefined cells. Will reconstruct the SNN graph
and weight matrix for these cells with ‘reduction’ space (usually be pca
or harmony). Only weight matrix that calculated by SNN is supported if
cells/idents/node is defined.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="idents">idents</code>
</td>
<td>
Calculate scores for these cell groups. The idents should be a vector of
group names in Idnets(object).
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="node">node</code>
</td>
<td>
A node to find markers for and all its children; requires
<code>BuildClusterTree</code> to have been run previously. Only can be
used if test all groups.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="reduction">reduction</code>
</td>
<td>
Dimension reduction name for constructing SNN graph and weight matrix.
Default is ‘pca’. This and following parameters only actived when cells
is set, because need to recalculate the SNN graph for the defined cells.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="dims">dims</code>
</td>
<td>
Dimensions of reduction used to construct SNN graph.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="k.param">k.param</code>
</td>
<td>
Defines k for the k-nearest neighbor algorithm.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="prune.SNN">prune.SNN</code>
</td>
<td>
Sets the cutoff for acceptable Jaccard index when computing the
neighborhood overlap for the SNN construction. Any edges with values
less than or equal to this will be set to 0 and removed from the SNN
graph. Essentially sets the stringency of pruning (0 — no pruning, 1 —
prune everything). Default is 1/50.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="n.trees">n.trees</code>
</td>
<td>
More trees gives higher precision when using annoy approximate nearest
neighbor search. Default is 50.
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="nn.eps">nn.eps</code>
</td>
<td>
Error bound when performing nearest neighbor seach using RANN; default
of 0.0 implies exact nearest neighbor search
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="nn.method">nn.method</code>
</td>
<td>
Method for nearest neighbor finding. Options include: rann,
annoy(default).
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="annoy.metric">annoy.metric</code>
</td>
<td>
Distance metric for annoy. Options include: euclidean (default), cosine,
manhattan, and hamming
</td>
</tr>
<tr>
<td style="white-space: nowrap; font-family: monospace; vertical-align: top">
<code id="versbose">versbose</code>
</td>
<td>
Print log message. Default is TRUE.
</td>
</tr>
</table>
