{
  "hash": "757608e949622573aa75061aebeaa98c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Alelle specific gene expression analysis for single cell RNA sequencing\nformat:\n  html:\n    code-overflow: wrap\n---\nThis vignette uses gene and single nucleotide variant (SNV) expression files generated from the [Annotate Various Features for Alignment](anno.Rmd).\n\n\n## 0. Perform cell clustering with Seurat\n\nWe begin by performing cell clustering based on gene expression, which is identical to the first step outlined in the [Alternative splicing analysis for scRNA-seq](Yano_AS.Rmd). If you're continuing from the previous vignette, you are free to skip this section.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrequire(Yano)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: Yano\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching packages ────────────────────────────────────────────── Yano 1.2 ──\n✔ dplyr   1.1.4     ✔ Seurat  5.3.0\n✔ ggplot2 4.0.0     \n```\n\n\n:::\n\n```{.r .cell-code}\nexp <- ReadPISA(\"./exp/\")\n\nobj <- CreateSeuratObject(exp, min.features = 1000, min.cells = 10)\nobj[[\"percent.mt\"]] <- PercentageFeatureSet(obj, pattern = \"^MT-\")\nobj <- subset(obj, nFeature_RNA < 9000 & percent.mt < 20)\n\n# Downsampling to 2000 cells for fast testing\nobj <- obj[, sample(colnames(obj),2000)]\n\n# To improve visualization, we reduced the resolution when identifying cell clusters.\nobj <- NormalizeData(obj) %>% FindVariableFeatures() %>% ScaleData() %>%  RunPCA(verbose=FALSE) %>% FindNeighbors(dims = 1:10, verbose=FALSE) %>% FindClusters(resolution = 0.1, verbose=FALSE) %>% RunUMAP(dims=1:10, verbose=FALSE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNormalizing layer: counts\nFinding variable features for layer counts\nCentering and scaling data matrix\n```\n\n\n:::\n\n```{.r .cell-code}\nDimPlot(obj, label=TRUE, label.size = 5, label.box = TRUE)\n```\n\n::: {.cell-output-display}\n![](Yano_ASE_files/figure-html/unnamed-chunk-1-1.png){fig-align='center' width=672}\n:::\n:::\n\n## 1. Perform allele-specific gene expression analysis by using SNV anchors\n\nIn this vignette, when a genetic variant is detected, all possible alleles at that location, including both alternative alleles and the reference allele, are annotated and counted. Therefore, genetic variants refer to both alternative alleles and the reference allele in this context.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar <- ReadPISA(\"./var\")\nobj[['var']] <- CreateAssayObject(var[,colnames(obj)], min.cells = 10)\n# Switch working assay to 'var'\nDefaultAssay(obj) <- \"var\"\n\nobj <- NormalizeData(obj)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `slot` argument of `SetAssayData()` is deprecated as of SeuratObject 5.0.0.\nℹ Please use the `layer` argument instead.\nℹ The deprecated feature was likely used in the Seurat package.\n  Please report the issue at <https://github.com/satijalab/seurat/issues>.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `slot` argument of `GetAssayData()` is deprecated as of SeuratObject 5.0.0.\nℹ Please use the `layer` argument instead.\nℹ The deprecated feature was likely used in the Seurat package.\n  Please report the issue at <https://github.com/satijalab/seurat/issues>.\n```\n\n\n:::\n\n```{.r .cell-code}\n# you can skip to read GTF again if you already load it\ngtf <- gtf2db(\"./gencode.v44.annotation.gtf.gz\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[2026-01-13 12:57:50] GTF loading..\n[2026-01-13 12:58:34] Load 62700 genes.\n[2026-01-13 12:58:34] Load time : 43.905 sec\n```\n\n\n:::\n\n```{.r .cell-code}\n# At this moment the meta infomation for genetic variant assay is still empty\nobj[['var']][[]] %>% head\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ndata frame with 0 columns and 6 rows\n```\n\n\n:::\n\n```{.r .cell-code}\nobj <- annoVAR(obj, gtf = gtf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[warnings] Chromosome KI270442.1 not found in GTF, use wrong database? \n[warnings] Chromosome KI270729.1 not found in GTF, use wrong database? \n[warnings] Chromosome GL000205.2 not found in GTF, use wrong database? \n[warnings] Chromosome GL000195.1 not found in GTF, use wrong database? \n[warnings] Chromosome KI270733.1 not found in GTF, use wrong database? \n[warnings] Chromosome GL000219.1 not found in GTF, use wrong database? \n[warnings] Chromosome GL000216.2 not found in GTF, use wrong database? \n[warnings] Chromosome GL000218.1 not found in GTF, use wrong database? \n[warnings] Chromosome KI270713.1 not found in GTF, use wrong database? \n```\n\n\n:::\n\n```{.r .cell-code}\n# After annotation, the locations are parsed from the feature name, and overlapped gene are also annotated.\nobj[['var']][[]] %>% head %>% knitr::kable()\n```\n\n::: {.cell-output-display}\n\n\n|                 |chr  |  start|ref |alt |strand |locus         |gene_name |type |\n|:----------------|:----|------:|:---|:---|:------|:-------------|:---------|:----|\n|chr1:633192G=/+  |chr1 | 633192|G   |G   |+      |chr1:633192/+ |MTCO2P12  |utr5 |\n|chr1:634337T>C/+ |chr1 | 634337|T   |C   |+      |chr1:634337/+ |MTATP6P1  |utr5 |\n|chr1:853876T>C/+ |chr1 | 853876|T   |C   |+      |chr1:853876/+ |LINC01128 |utr5 |\n|chr1:944296G>A/- |chr1 | 944296|G   |A   |-      |chr1:944296/- |NOC2L     |utr3 |\n|chr1:944296G>A/+ |chr1 | 944296|G   |A   |+      |chr1:944296/+ |SAMD11    |utr5 |\n|chr1:944307T>C/+ |chr1 | 944307|T   |C   |+      |chr1:944307/+ |SAMD11    |utr5 |\n\n\n:::\n\n```{.r .cell-code}\n# Select autocorrlated genetic variants \nobj <- RunAutoCorr(obj)\n```\n:::\n\n\nIn the alternative splicing analysis, we use mode 1 (the default mode). However, for allele-specific gene expression, we switch to mode 2 to compare the expression of an SNV with other SNVs at the same location. Since no binding assay is specified, the records at the same locus are first aggregated, and then the test feature is subtracted from the aggregated data (mode 2).\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nobj <- RunSDT(object = obj, bind.name = \"locus\", mode = 2)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWorking on assay var.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nUse predefined weight matrix \"pca_wm\".\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nProcessing 13362 features.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNo bind.assay specified, update min.features.per.block to 2.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nProcessing 4097 binding features.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nUse \"counts\" layer for test features.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nAggregate counts for binding features.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nUsing 63 threads.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRuntime : 9.111135 secs.\n```\n\n\n:::\n\n```{.r .cell-code}\nsel.chrs <- c(1:21, \"X\")\nFbtPlot(obj, val = \"locus.padj\", remove.chr = TRUE, sel.chrs = sel.chrs)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.\nℹ Please use the `linewidth` argument instead.\nℹ The deprecated feature was likely used in the Yano package.\n  Please report the issue to the authors.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.\nℹ Please use the `linewidth` argument instead.\nℹ The deprecated feature was likely used in the Yano package.\n  Please report the issue to the authors.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Yano_ASE_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=1152}\n:::\n\n```{.r .cell-code}\n# Let's random pick a pair of features at the same locus\nobj[['var']][[]] %>% filter(locus.padj < 1e-10) %>% knitr::kable()\n```\n\n::: {.cell-output-display}\n\n\n|                    |chr   |    start|ref |alt |strand |locus            |gene_name |type | moransi.pval|   moransi|autocorr.variable |   locus.D|    locus.t| locus.pval| locus.padj|\n|:-------------------|:-----|--------:|:---|:---|:------|:----------------|:---------|:----|------------:|---------:|:-----------------|---------:|----------:|----------:|----------:|\n|chr10:12250345A>G/+ |chr10 | 12250345|A   |G   |+      |chr10:12250345/+ |CDC123    |utr5 |            0| 0.0476105|TRUE              | 0.3757408|  -9.481203|          0|          0|\n|chr10:17237326C>T/+ |chr10 | 17237326|C   |T   |+      |chr10:17237326/+ |VIM       |utr5 |            0| 0.6889002|TRUE              | 1.4660226| -25.466903|          0|          0|\n|chr10:17237326C=/+  |chr10 | 17237326|C   |C   |+      |chr10:17237326/+ |VIM       |utr5 |            0| 0.5874119|TRUE              | 0.9576055| -27.505608|          0|          0|\n|chr10:62069780C=/+  |chr10 | 62069780|C   |C   |+      |chr10:62069780/+ |ARID5B    |exon |            0| 0.1016406|TRUE              | 0.4025481| -10.877033|          0|          0|\n|chr10:62069780C>T/+ |chr10 | 62069780|C   |T   |+      |chr10:62069780/+ |ARID5B    |exon |            0| 0.1112858|TRUE              | 0.4432294|  -9.775477|          0|          0|\n|chr10:71816550C=/-  |chr10 | 71816550|C   |C   |-      |chr10:71816550/- |PSAP      |utr3 |            0| 0.3129525|TRUE              | 0.5562426| -16.306266|          0|          0|\n|chr2:74969604A>G/+  |chr2  | 74969604|A   |G   |+      |chr2:74969604/+  |POLE4     |utr5 |            0| 0.1183157|TRUE              | 0.5381954| -16.739082|          0|          0|\n|chr20:63521953A>C/+ |chr20 | 63521953|A   |C   |+      |chr20:63521953/+ |PPDPF     |utr5 |            0| 0.1016253|TRUE              | 0.3995523| -10.251637|          0|          0|\n|chrM:8860A>G/+      |chrM  |     8860|A   |G   |+      |chrM:8860/+      |MT-ATP6   |exon |            0| 0.1675397|TRUE              | 0.5565051| -12.042075|          0|          0|\n\n\n:::\n\n```{.r .cell-code}\nFeaturePlot(obj, features = c(\"chr10:17237326C>T/+\", \"chr10:17237326C=/+\", \"VIM\" ), order=TRUE, pt.size = 1, ncol=3)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `slot` argument of `FetchData()` is deprecated as of SeuratObject 5.0.0.\nℹ Please use the `layer` argument instead.\nℹ The deprecated feature was likely used in the Seurat package.\n  Please report the issue at <https://github.com/satijalab/seurat/issues>.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Could not find VIM in the default search locations, found in 'RNA'\nassay instead\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Yano_ASE_files/figure-html/unnamed-chunk-3-2.png){fig-align='center' width=1152}\n:::\n\n```{.r .cell-code}\n# We could also zoom in specific region\nFbtPlot(obj, val = \"locus.padj\", chr=\"chr10\", start = 17225000, end = 17240000, gtf = gtf)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nZoom in chr10 : 17224000-17241000\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\nℹ The deprecated feature was likely used in the Yano package.\n  Please report the issue to the authors.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Yano_ASE_files/figure-html/unnamed-chunk-3-3.png){fig-align='center' width=1152}\n:::\n:::\n\nIt appears that the T allele of the gene VIM is expressed in most cell groups, while the C allele seems to be primarily expressed in groups 1 and 4.\n\nUsing our spatial dissimilarity analysis method, we have identified many cases of allele-specific gene expression. This phenomenon can be influenced by several known and unknown mechanisms, including gene imprinting, genetic recombination, and somatic variants during cell or disease development. While we won't explore these mechanisms in detail here, you can refer to our manuscript, which includes several case studies dedicated to this topic.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save the Seurat object for further use\nsaveRDS(obj, file = \"glioblastoma5k.rds\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nCommand(obj)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"NormalizeData.RNA\"        \"FindVariableFeatures.RNA\"\n [3] \"ScaleData.RNA\"            \"RunPCA.RNA\"              \n [5] \"FindNeighbors.RNA.pca\"    \"FindClusters\"            \n [7] \"RunUMAP.RNA.pca\"          \"NormalizeData.var\"       \n [9] \"ParseVarName.var\"         \"annoVAR.var\"             \n[11] \"RunAutoCorr.var.pca\"      \"SetAutoCorrFeatures.var\" \n[13] \"RunSDT.var\"              \n```\n\n\n:::\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.5.2 (2025-10-31)\nPlatform: x86_64-pc-linux-gnu\nRunning under: Ubuntu 22.04.5 LTS\n\nMatrix products: default\nBLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 \nLAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0\n\nlocale:\n [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       \n [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   \n [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          \n[10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   \n\ntime zone: Etc/UTC\ntzcode source: system (glibc)\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] future_1.67.0      dplyr_1.1.4        Seurat_5.3.0       SeuratObject_5.2.0\n[5] sp_2.2-0           ggplot2_4.0.0      Yano_1.2          \n\nloaded via a namespace (and not attached):\n  [1] deldir_2.0-4           pbapply_1.7-4          gridExtra_2.3         \n  [4] rlang_1.1.6            magrittr_2.0.4         RcppAnnoy_0.0.22      \n  [7] spatstat.geom_3.6-0    matrixStats_1.5.0      ggridges_0.5.7        \n [10] compiler_4.5.2         png_0.1-8              vctrs_0.6.5           \n [13] reshape2_1.4.4         stringr_1.5.2          pkgconfig_2.0.3       \n [16] fastmap_1.2.0          labeling_0.4.3         promises_1.3.3        \n [19] rmarkdown_2.30         purrr_1.1.0            xfun_0.53             \n [22] jsonlite_2.0.0         goftest_1.2-3          later_1.4.4           \n [25] spatstat.utils_3.2-0   irlba_2.3.5.1          parallel_4.5.2        \n [28] cluster_2.1.8.1        R6_2.6.1               ica_1.0-3             \n [31] stringi_1.8.7          RColorBrewer_1.1-3     spatstat.data_3.1-9   \n [34] reticulate_1.43.0      spatstat.univar_3.1-4  parallelly_1.45.1     \n [37] lmtest_0.9-40          scattermore_1.2        Rcpp_1.1.0            \n [40] knitr_1.50             tensor_1.5.1           future.apply_1.20.0   \n [43] zoo_1.8-14             R.utils_2.13.0         sctransform_0.4.2     \n [46] httpuv_1.6.16          Matrix_1.7-4           splines_4.5.2         \n [49] igraph_2.2.0           tidyselect_1.2.1       viridis_0.6.5         \n [52] abind_1.4-8            yaml_2.3.10            spatstat.random_3.4-2 \n [55] codetools_0.2-19       miniUI_0.1.2           spatstat.explore_3.5-3\n [58] listenv_0.9.1          lattice_0.22-5         tibble_3.3.0          \n [61] plyr_1.8.9             withr_3.0.2            shiny_1.11.1          \n [64] S7_0.2.0               ROCR_1.0-11            evaluate_1.0.5        \n [67] Rtsne_0.17             fastDummies_1.7.5      survival_3.8-3        \n [70] polyclip_1.10-7        fitdistrplus_1.2-4     pillar_1.11.1         \n [73] KernSmooth_2.23-26     plotly_4.11.0          generics_0.1.4        \n [76] RcppHNSW_0.6.0         scales_1.4.0           gtools_3.9.5          \n [79] globals_0.18.0         xtable_1.8-4           glue_1.8.0            \n [82] lazyeval_0.2.2         tools_4.5.2            data.table_1.17.8     \n [85] RSpectra_0.16-2        RANN_2.6.2             dotCall64_1.2         \n [88] cowplot_1.2.0          grid_4.5.2             tidyr_1.3.1           \n [91] nlme_3.1-168           patchwork_1.3.2        cli_3.6.5             \n [94] spatstat.sparse_3.1-0  spam_2.11-1            viridisLite_0.4.2     \n [97] uwot_0.2.3             gtable_0.3.6           R.methodsS3_1.8.2     \n[100] digest_0.6.37          progressr_0.17.0       ggrepel_0.9.6         \n[103] htmlwidgets_1.6.4      farver_2.1.2           htmltools_0.5.8.1     \n[106] R.oo_1.27.1            lifecycle_1.0.4        httr_1.4.7            \n[109] mime_0.13              MASS_7.3-65           \n```\n\n\n:::\n:::\n\n",
    "supporting": [
      "Yano_ASE_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}