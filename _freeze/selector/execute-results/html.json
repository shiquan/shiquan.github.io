{
  "hash": "19d915d37de11c3b11112ff93923f4a7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Select cells from reduction maps and spatial locations\nformat:\n  html:\n    code-overflow: wrap\n---\n\nThis vignette demonstrates how to use Yano buildin functions to interactively select or pick cells/spots from a plot using your mouse and keyboard. While tools like CellxGene are widely used for this purpose, to the best of our knowledge, an efficient solution for performing this task within the R environment is still lacking. Here, we introduce a lightweight, fast and native implementation of a cell selector to address this gap.\n\n## Prepare the data.\nWe use demo data from SeuratData for simplity.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(Yano)\nrequire(SeuratData)\n\nInstallData(\"stxBrain\")\n\nbrain <- LoadData(\"stxBrain\", type = \"anterior1\")\nbrain <- SCTransform(brain, assay = \"Spatial\", verbose = FALSE)\nbrain <- RunPCA(brain, assay = \"SCT\", verbose = FALSE)\nbrain <- FindNeighbors(brain, reduction = \"pca\", dims = 1:30)\nbrain <- FindClusters(brain, verbose = FALSE)\nbrain <- RunUMAP(brain, reduction = \"pca\", dims = 1:30)\n\nSpatialPlot(brain)\n```\n\n::: {.cell-output-display}\n![](selector_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n## Select spots from spatial plot\n```r\nsel.1 <- SpatialSelector(brain)\n```\n***Press `ESC` on your keyboard to exist the selection!***\n\n![](spatial_selector.gif){width=50%}\n\n\nNow the selected cells will be exported to `sel.1`. If you want return a object, try to set `return.object=TRUE` in the function.\n\n\n## Select cells from dimension reduction plot\n\nWe can also select cells from dimension reduction plot.\n\n::: {.cell}\n\n```{.r .cell-code}\nDimPlot(brain)\n```\n\n::: {.cell-output-display}\n![](selector_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n```r\nsel.1 <- DimSelector(brain)\n```\n\n***Press `ESC` on your keyboard to exist the selection!***\n\n![](dim_selector.gif){width=50%}\n\n## Select cells based on a feature expression\n\n::: {.cell}\n\n```{.r .cell-code}\nFeaturePlot(brain, features = c('Ttr'), order=TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `slot` argument of `FetchData()` is deprecated as of SeuratObject 5.0.0.\nℹ Please use the `layer` argument instead.\nℹ The deprecated feature was likely used in the Seurat package.\n  Please report the issue at <https://github.com/satijalab/seurat/issues>.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](selector_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n```r\nFeatureSelector(brain, feature = c('Ttr'), order=TRUE)\n```\n\nPlease note in `FeatureSelector()` only one feature is support at each selection. Therefore, I designed the parameter `feature` instead of orignal `features` here.\n\n![](feature_selector.gif){width=50%}\n\n\n## Select cells from Image-based spatial data\n\nHere we will use 10x Genomics Xenium data, generated from [Seurat's tutorial](https://satijalab.org/seurat/articles/seurat5_spatial_vignette_2).\n\n::: {.cell warnings='false'}\n\n```{.r .cell-code}\nxenium.obj <- readRDS(\"xenium.rds\")\nImageDimPlot(xenium.obj, border.color = \"white\", border.size = 0.1, cols = \"polychrome\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: No FOV associated with assay 'SCT', using global default FOV\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.\nℹ Please use the `linewidth` argument instead.\nℹ The deprecated feature was likely used in the Seurat package.\n  Please report the issue at <https://github.com/satijalab/seurat/issues>.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.\nℹ Please use the `linewidth` argument instead.\nℹ The deprecated feature was likely used in the Seurat package.\n  Please report the issue at <https://github.com/satijalab/seurat/issues>.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](selector_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n```r\nImageDimSelector(xenium.obj, border.color = \"white\", border.size = 0.1)\n```\n![](image_selector.gif){width=80%}\n\n\n## Generate 2D concave hull of selected region\n\nIn spatial transcriptomics, it is sometimes necessary to manually define capsule or membrane regions, as these areas are often thin, mixed with neighboring cells, and difficult to identify accurately. Manually specifying these regions can be beneficial for downstream analyses, where precise spatial organization of cells is critical for understanding tissue architecture and functional gradients.\n\n```r\nsel <- SpatialConcaveHull(brain)\n```\n\n![](concave_selector.gif){width=50%}\n\n\n## Questions?\n\nIf you have any questions regarding this vignette, the usage of Yano or suggestions, please feel free to report them through the [discussion forum](https://github.com/shiquan/Yano/discussions).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.5.2 (2025-10-31)\nPlatform: x86_64-pc-linux-gnu\nRunning under: Ubuntu 22.04.5 LTS\n\nMatrix products: default\nBLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 \nLAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0\n\nlocale:\n [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       \n [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   \n [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          \n[10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   \n\ntime zone: Etc/UTC\ntzcode source: system (glibc)\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] future_1.67.0             stxBrain.SeuratData_0.1.2\n[3] SeuratData_0.2.2.9002     dplyr_1.1.4              \n[5] Seurat_5.3.0              SeuratObject_5.2.0       \n[7] sp_2.2-0                  ggplot2_4.0.0            \n[9] Yano_1.2                 \n\nloaded via a namespace (and not attached):\n  [1] RColorBrewer_1.1-3          jsonlite_2.0.0             \n  [3] magrittr_2.0.4              spatstat.utils_3.2-0       \n  [5] farver_2.1.2                rmarkdown_2.30             \n  [7] vctrs_0.6.5                 ROCR_1.0-11                \n  [9] DelayedMatrixStats_1.30.0   spatstat.explore_3.5-3     \n [11] S4Arrays_1.8.1              htmltools_0.5.8.1          \n [13] SparseArray_1.8.1           sctransform_0.4.2          \n [15] parallelly_1.45.1           KernSmooth_2.23-26         \n [17] htmlwidgets_1.6.4           ica_1.0-3                  \n [19] plyr_1.8.9                  plotly_4.11.0              \n [21] zoo_1.8-14                  igraph_2.2.0               \n [23] mime_0.13                   lifecycle_1.0.4            \n [25] pkgconfig_2.0.3             Matrix_1.7-4               \n [27] R6_2.6.1                    fastmap_1.2.0              \n [29] GenomeInfoDbData_1.2.14     MatrixGenerics_1.20.0      \n [31] fitdistrplus_1.2-4          shiny_1.11.1               \n [33] digest_0.6.37               patchwork_1.3.2            \n [35] S4Vectors_0.46.0            tensor_1.5.1               \n [37] RSpectra_0.16-2             irlba_2.3.5.1              \n [39] GenomicRanges_1.60.0        beachmat_2.24.0            \n [41] labeling_0.4.3              progressr_0.17.0           \n [43] spatstat.sparse_3.1-0       httr_1.4.7                 \n [45] polyclip_1.10-7             abind_1.4-8                \n [47] compiler_4.5.2              withr_3.0.2                \n [49] S7_0.2.0                    viridis_0.6.5              \n [51] fastDummies_1.7.5           R.utils_2.13.0             \n [53] MASS_7.3-65                 DelayedArray_0.34.1        \n [55] rappdirs_0.3.3              gtools_3.9.5               \n [57] tools_4.5.2                 lmtest_0.9-40              \n [59] httpuv_1.6.16               future.apply_1.20.0        \n [61] goftest_1.2-3               R.oo_1.27.1                \n [63] glmGamPoi_1.20.0            glue_1.8.0                 \n [65] nlme_3.1-168                promises_1.3.3             \n [67] grid_4.5.2                  Rtsne_0.17                 \n [69] cluster_2.1.8.1             reshape2_1.4.4             \n [71] generics_0.1.4              gtable_0.3.6               \n [73] spatstat.data_3.1-9         R.methodsS3_1.8.2          \n [75] tidyr_1.3.1                 data.table_1.17.8          \n [77] XVector_0.48.0              BiocGenerics_0.54.1        \n [79] spatstat.geom_3.6-0         RcppAnnoy_0.0.22           \n [81] ggrepel_0.9.6               RANN_2.6.2                 \n [83] pillar_1.11.1               stringr_1.5.2              \n [85] spam_2.11-1                 RcppHNSW_0.6.0             \n [87] later_1.4.4                 splines_4.5.2              \n [89] lattice_0.22-5              survival_3.8-3             \n [91] deldir_2.0-4                tidyselect_1.2.1           \n [93] miniUI_0.1.2                pbapply_1.7-4              \n [95] knitr_1.50                  gridExtra_2.3              \n [97] IRanges_2.42.0              SummarizedExperiment_1.38.1\n [99] scattermore_1.2             stats4_4.5.2               \n[101] xfun_0.53                   Biobase_2.68.0             \n[103] matrixStats_1.5.0           UCSC.utils_1.4.0           \n[105] stringi_1.8.7               lazyeval_0.2.2             \n[107] yaml_2.3.10                 evaluate_1.0.5             \n[109] codetools_0.2-19            tibble_3.3.0               \n[111] cli_3.6.5                   uwot_0.2.3                 \n[113] xtable_1.8-4                reticulate_1.43.0          \n[115] GenomeInfoDb_1.44.3         Rcpp_1.1.0                 \n[117] globals_0.18.0              spatstat.random_3.4-2      \n[119] png_0.1-8                   spatstat.univar_3.1-4      \n[121] parallel_4.5.2              dotCall64_1.2              \n[123] sparseMatrixStats_1.20.0    listenv_0.9.1              \n[125] viridisLite_0.4.2           scales_1.4.0               \n[127] ggridges_0.5.7              purrr_1.1.0                \n[129] crayon_1.5.3                rlang_1.1.6                \n[131] cowplot_1.2.0              \n```\n\n\n:::\n:::\n\n",
    "supporting": [
      "selector_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}